import os
import scapy.all as scapy

os.system('ip netns del h1 > /dev/null')
os.system('ip netns del h2 > /dev/null')
os.system('ip netns del h3 > /dev/null')
os.system('ip netns add h1 > /dev/null')
os.system('ip netns add h2 > /dev/null')
os.system('ip netns add h3 > /dev/null')
os.system('echo 1 > /proc/sys/net/ipv4/ip_forward')


h1::VPort(ifname='h1-0', netns='/var/run/netns/h1',
			   mac_addr='00:00:00:00:00:01', ip_addrs=['10.0.1.1/24'])
h2::VPort(ifname='h2-0', netns='/var/run/netns/h2',
			   mac_addr='00:00:00:00:00:02', ip_addrs=['10.0.1.2/24'])
h3::VPort(ifname='h3-0', netns='/var/run/netns/h3',
			   mac_addr='00:00:00:00:00:03', ip_addrs=['10.0.1.3/24'])

os.system('ip netns exec h1 ifconfig lo up > /dev/null')
os.system('ip netns exec h2 ifconfig lo up > /dev/null')
os.system('ip netns exec h3 ifconfig lo up > /dev/null')

#out_h1::PortOut(port=h1)
#out_h2::PortOut(port=h2)
#out_h3::PortOut(port=h3)

merge::Merge()

l2f::L2Forward()
l2f.add(entries=[
	{'addr':'00:00:00:00:00:01', 'gate':0},
	{'addr':'00:00:00:00:00:02', 'gate':1}])
	
PortInc(port=h1) -> 0:merge
PortInc(port=h2) -> 1:merge
PortInc(port=h3) -> 2:merge

merge -> l2f

l2f:0 -> PortOut(port=h1)
l2f:1 -> PortOut(port=h2)